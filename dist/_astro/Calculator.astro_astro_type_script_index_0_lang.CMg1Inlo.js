const y=await f();async function f(){console.log("Fetched start");const n=await fetch("/heaton/search_map_radiator_power.json");if(!n.ok)throw new Error("Fail to fetch heaters powers");const a=await n.json();return console.log(`Fetched ${a.length}`),a}function b(n,a,t,s,c,e){return n*a*t*s*(e-c)}function v(n){const a=document.querySelector("#calculatorExtra");let t={};if(a){const h=a.querySelector('select[name="lenght"]'),p=a.querySelector('select[name="height"]'),g=a.querySelector('select[name="connectionSide"]'),m=a.querySelector('select[name="typeOfHeater"]');t={lenght:h.selectedIndex===0?null:parseInt(h.value),height:p.selectedIndex===0?null:parseInt(p.value),isSide:g.selectedIndex===0?null:g.selectedIndex===1,isHygiene:m.selectedIndex===0?null:m.selectedIndex===1}}const s=n.querySelector('input[name="area"]'),c=n.querySelector('input[name="temperature"]'),e=n.querySelector('input[name="homeTemperature"]'),l=n.querySelector('input[name="insulation"]:checked'),o=n.querySelector('input[name="windows"]:checked'),r=n.querySelector('input[name="glazing"]:checked'),u=n.querySelector('input[name="height"]:checked'),i=b(parseFloat(s.value),parseFloat(u.value),parseFloat(l.value),parseFloat(r.value),parseFloat(c.value),parseFloat(e.value)),d=new CustomEvent("calculatorFormHeatPower",{detail:{heat:i,count:parseInt(o.value),extra:t},bubbles:!0});document.dispatchEvent(d)}document.addEventListener("initCalculator",()=>{console.log("initCalculator"),document.querySelectorAll("#calculatorExtra select").forEach(e=>{e.addEventListener("change",l=>{const o=new CustomEvent("calculatorFormEvent",{bubbles:!0});document.dispatchEvent(o)})});const a=document.getElementById("calculator");v(a),document.addEventListener("calculatorFormEvent",e=>{v(a)}),document.addEventListener("heatersSearchComplete",e=>{const l=document.getElementById("outputField"),o=e.detail.heaters,r=e.detail.heaters_count;let u="";o.slice(0,6).forEach((i,d)=>{u+=`<li class="flex items-center gap-2 p-2 cursor-pointer sm:gap-8 rounded-xl hover:bg-neutral-100 slide-from-top a-delay-${d}">
                    <a href="/heaton/${i.url}" class="flex flex-col items-start grow">
                      <div class="font-black">${i.name}</div>
                      <ul class="flex items-center gap-1">
                        <li class="px-1 sm:px-2 py-0.5 text-xs rounded-full output_power_badge bg-secondary power whitespace-nowrap">${i.power} Вт</li>
                        <li class="px-1 sm:px-2 py-0.5 text-xs rounded-full output_power_badge bg-neutral-50/30 border border-neutral-300 connection">${i.side?"Боковое":"Нижнее"}</li>
                        <li class="px-1 sm:px-2 py-0.5 text-xs rounded-full output_power_badge bg-neutral-50/30 border border-neutral-300 type empty:hidden">${i.hygiene?"Гигиенический":""}</li>
                      </ul>
                    </a>
                    <a class="flex items-center gap-4 text-neutral-700/30">
                      <div class="font-black">
                        <span class="text-xl">x</span>
                      </div>
                      <div class="font-black ">
                        <span class="text-4xl">${r}</span><span>&nbsp;шт</span>
                      </div>
                    </a>
          </li>`}),l.innerHTML=u}),document.addEventListener("calculatorFormHeatPower",e=>{const l=document.getElementById("totalPower"),o=parseInt(e.detail.heat),r=parseInt(e.detail.count);l.textContent=`${o} Вт`,E(Math.ceil(o/r),e.detail.extra,r)});const t=document.querySelectorAll('input[type="range"]');let s=setTimeout(function(){t[0].dispatchEvent(new Event("input",{bubbles:!0}))},200);function c(e){let l=e.target;e.target.type!=="range"&&(l=document.getElementById("range"));const o=l.min,r=l.max,u=l.value;l.style.backgroundSize=(u-o)*100/(r-o)+"% 100%";const i=l.closest(".flex").querySelector(".value");i.textContent=u,clearTimeout(s),s=setTimeout(function(){const d=new CustomEvent("calculatorFormEvent",{detail:{values:{name:l.name,value:l.value}},bubbles:!0});document.dispatchEvent(d)},50)}t.forEach(e=>{e.addEventListener("input",c);const l=e.closest(".flex").querySelector(".value");e.value=l.textContent;const o=e.min,r=e.max,u=e.value;e.style.backgroundSize=(u-o)*100/(r-o)+"% 100%"})});document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded")});function w(n,a){let t=0,s=n.length-1,c=-1;for(;t<=s;){let e=Math.floor((t+s)/2);n[e].power>a?(c=e,s=e-1):t=e+1}return c}function x(n,a,t){let s=w(n,a);if(s===-1)return[];let c=[],e=s,l=s;for(;c.length<100&&(e>=0||l<n.length);)if(e>=0&&(l>=n.length||n[e].power>a))c.push(n[e]),e--;else if(l<n.length&&n[l].power>a)c.push(n[l]),l++;else break;let o=c.filter(d=>(t.lenght===0||t.lenght===void 0||t.lenght===null||d.width===t.lenght)&&(t.height===0||t.height===void 0||t.height===null||d.height===t.height)&&(t.isSide===0||t.isSide===void 0||t.isSide===null||d.side===t.isSide)&&(t.isHygiene===0||t.isHygiene===void 0||t.isHygiene===null||d.hygiene===t.isHygiene)),r=[],u=0,i=o.length-1;for(;r.length<20&&u<=i;)Math.abs(o[u].power-a)<=Math.abs(o[i].power-a)?(r.push(o[u]),u++):(r.push(o[i]),i--);return r}async function E(n,a,t){try{const s=n,c=x(await y,s,a),e=new CustomEvent("heatersSearchComplete",{detail:{heaters:c,heaters_count:t},bubbles:!0});document.dispatchEvent(e)}catch(s){console.error("Error fetching radiators:",s)}}
