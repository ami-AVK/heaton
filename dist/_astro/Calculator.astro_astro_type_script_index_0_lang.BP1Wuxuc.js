let f=await b(),h;x();document.addEventListener("astro:page-load",e=>{console.log(e),console.log(f.length),document.getElementById("calculator")&&x()});async function b(){console.log("Fetched start");const e=await fetch("/heaton/search_map_radiator_power.json");if(!e.ok)throw new Error("Fail to fetch heaters powers");const a=await e.json();return console.log(`Fetched ${a.length}`),a}function y(e){const a=document.querySelector("#calculatorExtra");let t={};if(a){const p=a.querySelector('select[name="lenght"]'),g=a.querySelector('select[name="height"]'),m=a.querySelector('select[name="connectionSide"]'),v=a.querySelector('select[name="typeOfHeater"]');t={lenght:p.selectedIndex===0?null:parseInt(p.value),height:g.selectedIndex===0?null:parseInt(g.value),isSide:m.selectedIndex===0?null:m.selectedIndex===1,isHygiene:v.selectedIndex===0?null:v.selectedIndex===1}}const o=e.querySelector('input[name="area"]'),n=e.querySelector('input[name="temperature"]'),l=e.querySelector('input[name="homeTemperature"]'),s=e.querySelector('input[name="insulation"]:checked'),c=e.querySelector('input[name="windows"]:checked'),r=e.querySelector('input[name="glazing"]:checked'),u=e.querySelector('input[name="height"]:checked'),i=parseFloat(o.value)*parseFloat(u.value)*parseFloat(s.value)*parseFloat(r.value)*(parseFloat(l.value)-parseFloat(n.value)),d=new CustomEvent("HeatLostCalculationDone",{detail:{heat:i,count:parseInt(c.value),extra:t},bubbles:!0});document.dispatchEvent(d)}function w(e,a){const t=document.getElementById("outputField");let o="";e.slice(0,6).forEach((n,l)=>{o+=`<li class="flex items-center gap-2 p-2 cursor-pointer sm:gap-8 rounded-xl hover:bg-neutral-100 slide-from-top a-delay-${l}">
                    <a href="/heaton/${n.url}" class="flex flex-col items-start grow">
                      <div class="font-black">${n.name}</div>
                      <ul class="flex items-center gap-1">
                        <li class="px-1 sm:px-2 py-0.5 text-xs rounded-full output_power_badge bg-primary text-neutral-50 power whitespace-nowrap">${n.power} Вт</li>
                        <li class="px-1 sm:px-2 py-0.5 text-xs rounded-full output_power_badge bg-neutral-50/30 border border-neutral-300 connection">${n.side?"Боковое":"Нижнее"}</li>
                        <li class="px-1 sm:px-2 py-0.5 text-xs rounded-full output_power_badge bg-neutral-50/30 border border-neutral-300 type empty:hidden">${n.hygiene?"Гигиенический":""}</li>
                      </ul>
                    </a>
                    <a class="flex items-center gap-2 sm:gap-4 text-neutral-700/30">
                      <div class="font-black">
                        <span class="text-lg sm:text-xl">x</span>
                      </div>
                      <div class="font-black ">
                        <span class="text-3xl sm:text-4xl">${a}</span><span>&nbsp;шт</span>
                      </div>
                    </a>
          </li>`}),t.innerHTML=o}document.addEventListener("calculatorFormChange",e=>{console.log("calculatorFormChange"),h&&y(h)});document.addEventListener("heatersSearchComplete",e=>{console.log("heatersSearchComplete");const a=e.detail.heaters,t=e.detail.heatersCount;w(a,t)});document.addEventListener("HeatLostCalculationDone",e=>{console.log("HeatLostCalculationDone");const a=document.getElementById("totalPower"),t=parseInt(e.detail.heat),o=parseInt(e.detail.count);a.textContent=`${t} Вт`,I(Math.ceil(t/o),e.detail.extra,o)});function x(){document.querySelectorAll("#calculatorExtra select").forEach(n=>{n.addEventListener("change",l=>{const s=new CustomEvent("calculatorFormChange",{bubbles:!0});document.dispatchEvent(s)})}),h=document.getElementById("calculator"),y(h);const a=document.querySelectorAll('input[type="range"]');let t=setTimeout(function(){a[0].dispatchEvent(new Event("input",{bubbles:!0}))},200);function o(n){let l=n.target;n.target.type!=="range"&&(l=document.getElementById("range"));const s=l.min,c=l.max,r=l.value;l.style.backgroundSize=(r-s)*100/(c-s)+"% 100%";const u=l.closest(".flex").querySelector(".value");u.textContent=r,clearTimeout(t),t=setTimeout(function(){const i=new CustomEvent("calculatorFormChange",{detail:{values:{name:l.name,value:l.value}},bubbles:!0});document.dispatchEvent(i)},50)}a.forEach(n=>{n.addEventListener("input",o);const l=n.closest(".flex").querySelector(".value");n.value=l.textContent;const s=n.min,c=n.max,r=n.value;n.style.backgroundSize=(r-s)*100/(c-s)+"% 100%"})}function S(e,a){let t=0,o=e.length-1,n=-1;for(;t<=o;){let l=Math.floor((t+o)/2);e[l].power>a?(n=l,o=l-1):t=l+1}return n}function E(e,a,t){let o=S(e,a);if(o===-1)return[];let n=[],l=o,s=o;for(;n.length<100&&(l>=0||s<e.length);)if(l>=0&&(s>=e.length||e[l].power>a))n.push(e[l]),l--;else if(s<e.length&&e[s].power>a)n.push(e[s]),s++;else break;let c=n.filter(d=>(t.lenght===0||t.lenght===void 0||t.lenght===null||d.width===t.lenght)&&(t.height===0||t.height===void 0||t.height===null||d.height===t.height)&&(t.isSide===0||t.isSide===void 0||t.isSide===null||d.side===t.isSide)&&(t.isHygiene===0||t.isHygiene===void 0||t.isHygiene===null||d.hygiene===t.isHygiene)),r=[],u=0,i=c.length-1;for(;r.length<20&&u<=i;)Math.abs(c[u].power-a)<=Math.abs(c[i].power-a)?(r.push(c[u]),u++):(r.push(c[i]),i--);return r}async function I(e,a,t){try{const o=e,n=E(await f,o,a),l=new CustomEvent("heatersSearchComplete",{detail:{heaters:n,heatersCount:t},bubbles:!0});document.dispatchEvent(l)}catch(o){console.error("Error fetching radiators:",o)}}
