---
// Component Imports
import NavBar from '../components/NavBar.astro';
import ModelCard from '../components/_ModelCard.astro';
import TSlider from '../components/Inputs/TemperatureSlider.astro';
import { Image } from "astro:assets"
import heater from "../img/heater_main.webp"
import { Icon } from 'astro-icon/components';
import '../styles/main.css';
import { glob, globSync, globStream, globStreamSync, Glob } from 'glob'
import { ClientRouter } from 'astro:transitions';
import Footer from '../components/Footer.astro';
import Calculator from '../components/Calculator.astro';
import Button from '../components/ButtonFile.astro';


// Full Astro Component Syntax:
// https://docs.astro.build/basics/astro-components/
const collection = await glob([ "./src/data/**/**/*.csv"]);
const paths = collection.map((file) => ({
    props:{filePath:file.toString(),category: file.split('/')[2],model: file.split('/')[3],type: file.split('/')[4].replace(".csv","")},
  }));
const pathname = `/${paths[0].props.category}/${paths[0].props.model}/${paths[0].props.type}`
console.log(pathname);
---

<html lang="ru" class="scroll-smooth snap-y snap-mandatory">
	<head>
		<meta charset="utf-8" />
		<!-- <meta name="viewport" content="width=device-width" /> -->
		<meta name="viewport" content="width=device-width, height=device-height, minimum-scale=1.0, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href=`${import.meta.env.BASE_URL}/favicon.svg` />
		<!-- <meta name="generator" content={Astro.generator} /> -->
		<title>Heaton</title>
		<ClientRouter />
	</head>

	<body class="bg-neutral-100 ">



		<!-- hero -->
		<section class="relative w-full bg-gr-metallic min-h-svh overflow-x-clip snap-center">
			<div class="z-0 py-8 pb-16 container-center">
				<NavBar/>
				<div class="flex flex-col justify-center mt-[15%] ml-4 md:flex-row md:justify-start md:mt-32 md:ml-auto ">
					<div class="flex flex-col z-10 px-[10%] mt-12 sm:mt-24 md:mt-auto md:px-0 relative md:max-w-[40%] gap-4 sm:gap-12 md:my-auto sm:mr-[10%] order-2 md:order-1 lg:ml-16">
						<h1 class="text-2xl font-bold leading-none tracking-widest uppercase text-neutral-700 sm:text-4xl md:text-4xl lg:text-5xl xl:text-6xl sm:header-circle-lg lg:header-circle-xl">
							Стальные панельные радиаторы</h1>
						<p class="w-full text-xl font-light leading-none sm:text-2xl md:text-3xl xl:text-4xl text-neutral-600">
							Высокое качество <br/>по&nbsp;доступной цене
						</p>
					</div>
					<div class="relative px-[5%] md:px-0 md:max-w-[70%] z-0 min-h-[40svh] md:h-auto order-1 md:order-2 -bottom-16">
						<div class="absolute -top-[15%] left-1/2 hidden md:block">
							<div class="flex flex-col items-start justify-start gap-1">
								<div class="self-stretch text-base font-normal leading-none text-neutral-700 lg:text-lg lg:leading-none">СООТВЕТСВИЕ</div>
								<div class="self-stretch text-lg font-bold leading-none text-neutral-700 lg:text-xl lg:leading-none">ГОСТ 31311-2005</div>
							</div>
						</div>
						<div class="absolute -bottom-0 h-[120%] w-1/2 -z-10 right-0 sm:-left-8 bg-neutral-100 rounded-tl-[64px] rounded-tr-lg"></div>
						<div class="absolute bottom-16 lg:bottom-24 h-0.5 w-[150%] -z-10 -left-[150%] bg-gradient-to-l from-neutral-50 via-neutral-50/0 to-neutral-50/0 "></div>
						<div class="absolute z-10 w-32 h-32 border-2 rounded-full -right-16 -bottom-16 sm:-left-24 lg:h-48 lg:w-48 lg:-bottom-24 lg:-left-32 bg-neutral-50/30 backdrop-blur-sm border-neutral-50 scroll-scale-fade"></div>
						<Image alt="" src={heater}/>
					</div>
				</div>
			</div>
		</section>



		<!-- features -->
		<!-- <section class="pb-32 text-left container-center text-neutral-700 snap-start snap-always scroll-mt-32"> -->

			<!--  -->
			<div class="container-center my-16 tracking-widest flex flex-col md:flex-row pb-[10svh] pt-8  scroll-control perspective-1000 snap-center ">
				<div class="flex flex-col items-start py-8 md:py-24 px-6 sm:px-16 bg-neutral-200/40 rounded-br-3xl md:max-w-[calc(50%-6rem)] relative scroll_main_header transform-gpu ">
					<h2 class="max-w-screen-sm mb-2 text-2xl font-bold tracking-widest sm:mb-8 sm:text-4xl md:text-4xl lg:text-5xl sm:whitespace-nowrap ">Высочайшее качество, <br/>подтвержденное <br/>сертификатом</h2>
					<Button text="Сертификат соответствия" icon="Sertificate" type="download" size=20 link={`${import.meta.env.BASE_URL}/pasports/sertificate.pdf`}/>
				</div>				
				<div class="relative flex flex-col max-w-xl pt-8 sm:gap-4 sm:pl-12 sm:text-xl md:pt-48 md:pl-32 inview-block">
					{
						[
							["Произведены в Турции на заводе c богатейшим опытом","Sertificate",1],
							["Продукция имеет гигиенический сертификат","Sertificate",2],
							["Высококачественное сырье: холоднокатанная сталь 1,3 мм","Sertificate",3],
						]
						.map(([text,icon,index])=>(
							<div class="flex items-center gap-2 p-4 my-2 hover:bg-neutral-50 rounded-3xl group scroll-stagger" >
								<div class="max-w-48"><Icon name={icon} size={48}/></div>
								<h2 class="max-w-lg">{text}</h2>
								{/* <div class="absolute top-0 flex items-center justify-center invisible w-full h-32 text-xs tracking-widest text-center transition-opacity rounded-md opacity-0 left-32 bg-neutral-50 text-neutral-300 group-hover:opacity-100 group-hover:visible">Изображение к «{text}»</div> */}
							</div>
						))
					}
				</div>
			</div>

			<!--  -->
			<div class="container-center relative  md:-ml-16 tracking-widest flex flex-col md:flex-row mb-[10svh] md:my-[10svh] scroll-control items-center justify-center snap-center ">
				<div class="relative flex justify-end md:w-1/2">
					<div class="overflow-clip px-12 md:px-0 md:w-[32rem] md:mr-16">
						<div class="md:w-[42rem] relative">
							<Image alt="" src={heater}/>
							<div class="absolute z-10 w-32 h-32 border-2 rounded-full -bottom-16 -left-24 lg:h-48 lg:w-48 lg:-bottom-24 lg:-left-32 bg-neutral-50/30 backdrop-blur-sm border-neutral-50 "></div>
						</div>
					</div>
					
				</div>
				<div class="">
					<div class="relative flex flex-col items-start px-16 py-8 scroll_main_header">
						<h2 class="max-w-screen-sm mb-2 text-2xl font-bold tracking-widest sm:mb-8 sm:text-4xl md:text-4xl lg:text-5xl whitespace-nowrap">Широкий <br/>типоразмерный ряд</h2>
						<Button text="Каталог продукции" icon="Sertificate" type="link" size=20 link={`${import.meta.env.BASE_URL}/Стальные панельные радиаторы`}/>
					</div>
					<div class="relative flex flex-col pt-4 sm:gap-4 sm:text-xl sm:pl-12 inview-block">
						{
							[
								["В комплектацию входит все необходимое для монтажа радиатора на стену","Sertificate"],
								["Максимально быстрые сроки поставки","Sertificate"],
							]
							.map(([text,icon])=>(
								<div class="flex items-center gap-2 p-4 my-2 hover:bg-neutral-50 rounded-3xl group scroll-stagger">
									<div class="max-w-48"><Icon name={icon} size={48}/></div>
									<h2 class="max-w-lg">{text}</h2>
									{/* <div class="absolute top-0 flex items-center justify-center invisible w-full h-32 text-xs tracking-widest text-center transition-opacity rounded-md opacity-0 left-32 bg-neutral-50 text-neutral-300 group-hover:opacity-100 group-hover:visible">Изображение к «{text}»</div> */}
								</div>
							))
						}
					</div>
				</div>
			</div>

			<!--  -->
			<div class="container-center relative tracking-widest flex flex-col lg:flex-row items-center my-[10svh] min-h-[60svh] scroll-control perspective-1000 mx-auto snap-center ">
				<div class="order-2 lg:w-1/2 inview-scale will-change-transform lg:order-1">
					<div class="relative flex flex-col items-start px-16 py-8" >
						<h2 class="max-w-screen-sm mb-8 text-2xl font-bold tracking-widest md:text-4xl lg:text-5xl">Верхняя решетка крыловидной формы</h2>
						<p class="text-xl leading-loose">Форма верхней решетки имеет форму крыла, при такой форме ускоряется поток теплого воздуха через прибор, улучшая теплоотдачу</p>
					</div>
				</div>
				<div class="relative flex justify-end order-1 lg:w-1/2 lg:order-2">
					<div class="mx-8 lg:ml-16">
						<div class="relative">
							<Image alt="" src={heater}/>
						</div>
					</div>
				</div>
			</div>

			<!--  -->
			<div class="container-center relative  tracking-widest flex flex-col lg:flex-row items-center my-[10svh] min-h-[60svh] scroll-control perspective-1000 mx-auto snap-center ">
				<div class="relative flex justify-end lg:w-1/2">
					<div class="mx-8 lg:mr-16">
						<div class="relative">
							<Image alt="" src={heater}/>
						</div>
					</div>
				</div>
				<div class="inview-scale will-change-transform lg:w-1/2">
					<div class="relative flex flex-col items-start px-16 py-8">
						<h2 class="mb-8 text-2xl font-bold tracking-widest md:text-4xl lg:text-5xl lg:max-w-screen-sm">«Технология усечённого канала»</h2>
						<p class="text-xl leading-loose"> Частичное уменьшение сечения первых двух каналов панели радиатора, что способствует равномерному распределению потока теплоносителя по всей длине прибора</p>
					</div>
				</div>
			</div>
		<!-- </section> -->





		<!-- models -->
		<section class="bg-secondary/30 min-h-svh snap-center snap-always " id="models">
			<div class="flex flex-col items-center gap-16 py-16 md:py-32 container-center text-neutral-600">
				<h2 class="text-3xl font-semibold md:text-6xl header-circle-lg md:header-circle-xl ">Модели радиаторов</h2>
				<div class="grid grid-cols-1 gap-8 sm:grid-cols-2 xl:gap-16 lg:grid-cols-4">
					{
						[
							{
								shortName: "C",
								longName: "Compact",
								sub:null,
								url:`${import.meta.env.BASE_URL}/Стальные панельные радиаторы/Compact (C)/11`,
								characteristics: [
									{ name: "Панели", icon: true },
									{ name: "Рассеиватели", icon: true },
									{ name: "Решетка сверху", icon: true },
									{ name: "Боковое подключение", icon: true }
								]
							},
							{
								shortName: "VC",
								longName: "Ventil Compact",
								sub:null,
								url:`${import.meta.env.BASE_URL}/Стальные панельные радиаторы/Ventil Compact (VC)/11`,
								characteristics: [
									{ name: "Панели", icon: true },
									{ name: "Рассеиватели", icon: true },
									{ name: "Решетка сверху", icon: true },
									{ name: "Нижнее подключение", icon: true }
								]
							},
							{
								shortName: "HC",
								longName: "Compact",
								sub:"Hygiene",
								url:`${import.meta.env.BASE_URL}/Стальные панельные радиаторы/Hygiene Compact (HC)/10`,
								characteristics: [
									{ name: "Панели", icon: true },
									{ name: "Рассеиватели", icon: false },
									{ name: "Решетка сверху", icon: false },
									{ name: "Боковое подключение", icon: true }
								]
							},
							{
								shortName: "HVC",
								longName: "Ventil Compact",
								sub:"Hygiene",
								url:`${import.meta.env.BASE_URL}/Стальные панельные радиаторы/Hygiene Ventil Compact (HVC)/10`,
								characteristics: [
									{ name: "Панели", icon: true },
									{ name: "Рассеиватели", icon: false },
									{ name: "Решетка сверху", icon: false },
									{ name: "Нижнее подключение", icon: true }
								]
							}
						].map((element)=>(
							<ModelCard name={element.longName} shortname={element.shortName} characteristics={element.characteristics} subname={element.sub} url={element.url}/>
						))
					}
				</div>
			</div>
		</section>
		<!-- calculator -->
		 	<Calculator class="snap-center snap-always"/>
		
		<Footer class="snap-end"/>
	</body>
</html>

<script >
	import { animate,scroll,stagger, inView } from "motion";
	import Fuse from 'fuse.js'

	document.addEventListener('astro:page-load', async () => {

		const options = {
			includeScore: true,
			minMatchCharLength:3,
			threshold: 0.3,
			// Search in `author` and in `tags` array
			keys: ['Наименование', 'Категория']
		}

		// const fuse = new Fuse(list, options)
		// search_map.json
		const response = await fetch('/heaton/search_map.json');
        const data = await response.json();
		const fuse = new Fuse(data, options);

		
		document.addEventListener("searchInputEvent",(e)=>{

		})
		let result = fuse.search('1200')
		console.log(result);
		result = fuse.search('1200 400')
		console.log(result);
		result = fuse.search('1200 400 C')
		console.log(result);
		result = fuse.search('12C')
		console.log(result);
	});
	document.addEventListener('astro:page-load', () => {

		// animate("#motion-test",{ scale: [0.4, 1]});
		inView(".inview-block", ({ target }) => {
			const staggers = target.querySelectorAll(".scroll-stagger");
			animate(
				staggers,{ opacity: [0,1], scale:[1.1,1] }, { delay: stagger(0.3, {startDelay: 0.2}) , ease:"easeIn", duration:.6}
			)
        	return () => animate(staggers, { opacity: 0, scale:[1.1]})
    	},
		{ margin: "0px 0px -300px 0px" }
		);
		inView(".inview-scale", ({ target }) => {
			animate(
			target,{ opacity: [0,1], scale:[1.1,1], rotateY:[10,0] }, { delay: stagger(0.3) , ease:"easeIn", duration:.6}
			)
        	return () => animate(target, { opacity: 0, scale:[1.1], rotateY:[30]})
		});
		// document.querySelectorAll(".scroll-scale-fade").forEach((scaledElement) => {
		// 	scroll(
		// 		animate(
		// 			scaledElement, { scale:[1,7],opacity:[1,0]}, { ease: "linear"}),
		// 		{
		// 			target: scaledElement,
		// 			offset: ["end end", "end start"],
		// 		}
		// 	);
		// });
		document.querySelectorAll(".scroll-control").forEach((section ) => {
			const header = section.querySelector(".scroll_main_header") as HTMLDivElement;
			const staggers = section.querySelectorAll(".inview-block") as NodeList;
			const sequence = [
				[header, { opacity:[0,1],y:[400,0],rotateY:[45,0],rotateZ:[5,0]}, { ease: "linear" ,duration: .4}],
				[staggers, { opacity: [0,1], x: [300, 0], rotateY:[-45,0]},{ ease:  "easeInOut", at: .1, duration: .3 }],
				
			];
			// scroll(
			// 	animate(
			// 	section, 
			// 		{ opacity: [0,1], y: [400, 0]}, 
			// 		{ ease:  "easeOut"}), 
			// 	{
			// 		target: section,
			// 		offset: ["start end", "end end"],

			// 	}
			// );

			// scroll(
			// 	animate(
			// 		sequence as any),
			// 	{
			// 		target: section,
			// 		offset: ["start end", "end start"],
			// 	}
			// );
			scroll(
				animate(
					header, { opacity:[0,1],y:[400,0], rotateY:[30,0]}, { ease: "linear"}),
				{
					target: section,
					offset: ["start end", "end end"],
				}
			);


			// scroll(
			// 	animate(
			// 		staggers, 
			// 		{ opacity: [0,1], x: [300, 0]}, 
			// 		{ ease:  "easeInOut"}), 
			// 	{
			// 		target: section,
			// 		offset: ["start end", "end end"],

			// 	}
			// );
			// scroll(
			// 	animate(
			// 		staggers, 
			// 		{ opacity:[-1,1,1,1], x:[200,0,0,0] }, 
			// 		{ ease:"linear"}), 
					
			// 	{
			// 		target: header,
			// 		offset: ["start end", "end end", "start start", "end start"],
			// 	}
			// );
			});




	});
	
</script>
